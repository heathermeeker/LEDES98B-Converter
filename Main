<!--Copyright 2024 Heather Meeker
<html lang="en">
<body onload = "Set_Defaults()">
<h2>Bananafoot LEDES Converter</h2>
<h3><i>"Bananafoot: Making your law practice slightly less tedious"</i></h3>
This program allows you to enter information to create a LEDES 1998B billing file. LEDES is a standard format for legal invoicing. 
For information on the hell-spawn that is the LEDES format see <a href="https://ledes.org/ledes-98b-format"> LEDES Format</a>.  
LEDES is a text, pipe-delimited format. It was designed by lawyers, which explains a lot. When you click "Done" the program will allow you to save your LEDES file. <p>
<form>
<label for ="INVOICE_TOTAL">Invoice Total:</label>
<span id="INVOICE_TOTAL"></span>
<label for ="LINE_ITEM_NUMBER">Lines Total:</label><br>
<span id="LINE_ITEM_NUMBER"></span>
<!-- The fields that are the same for the entire invoice-->
  <label for ="INVOICE_NUMBER">Invoice Number:</label>
  <input type="text" id="INVOICE_NUMBER" name="INVOICE_NUMBER">
  <label for ="INVOICE_DATE">Invoice Date:</label>
  <input type="date" onchange = "getPreviousMonthDates()" id="INVOICE_DATE" name="INVOICE_DATE"><p>
  <label for ="CLIENT_ID">Client ID:</label>
  <input type="text" id="CLIENT_ID" name="CLIENT_ID">
  <label for ="CLIENT_MATTER_ID">Client Matter ID:</label>
  <input type="text" id="CLIENT_MATTER_ID" name="CLIENT_MATTER_ID"><br>
  <label for ="LAW_FIRM_MATTER_ID">Law Firm Matter:</label>
  <input type="text" id="LAW_FIRM_MATTER_ID" name="LAW_FIRM_MATTER_ID">
  <label for ="LAW_FIRM_ID">Law Firm:</label>
  <input type="text" id="LAW_FIRM_ID" name="LAW_FIRM_ID"><br>
  <label for ="BILLING_START_DATE">Billing Start Date:</label>
  <input type="date" id="BILLING_START_DATE" name="BILLING_START_DATE" >
  <label for ="BILLING_END_DATE">Billing End Date:</label>
  <input type="date" id="BILLING_END_DATE" name="BILLING_END_DATE" ><br>
  <label for ="INVOICE_DESCRIPTION">Invoice Description:</label>
  <input type="text" id="INVOICE_DESCRIPTION" name="INVOICE_DESCRIPTION" value = "Legal Services"> This field is optional.<br>
<! -- Line item fields -->
Line Item Fields:<br>
<label for= "LINE_ITEM_DATE">Line Item Date:</label>
<input type="date" onchange = "Date_Check()" id="LINE_ITEM_DATE" name="LINE_ITEM_DATE"><br>
<! -- Alert if date is not within start and end dates -- TBD-->
<label for= "TIMEKEEPER_ID">Timekeeper ID:</label>
<input type="text" id="TIMEKEEPER_ID" name="TIMEKEEPER_ID"><br>
<label for= "LINE_ITEM_DESCRIPTION">Description:</label>
<input type="text" id="LINE_ITEM_DESCRIPTION" name="LINE_ITEM_DESCRIPTIOND"><br>
<label for= "TIMEKEEPER_NAME">Timekeeper Name:</label>
<input type="text" id="TIMEKEEPER_NAME" name="TIMEKEEPER_NAME"><br>
<label for= "TIMEKEEPER_CLASSIFICATION">Timekeeper Classification:</label>
<input type="text" id="TIMEKEEPER_CLASSIFICATION" name="TIMEKEEPER_CLASSIFICATION"><br>
<label for= "LINE_ITEM_NUMBER_OF_UNITS">Line Item Units:</label>
<input type="number" onchange = "Update_Line_Item_Total()" id="LINE_ITEM_NUMBER_OF_UNITS" name="LINE_ITEM_NUMBER_OF_UNITS">
<label for= "LINE_ITEM_UNIT_COST">Line Item Unit Cost:</label>
<input type="number" onchange = "Update_Line_Item_Total()" id="LINE_ITEM_ADJUSTMENT_AMOUNT" name="LINE_ITEM_ADJUSTMENT_AMOUNT"><br>
<label for= "LINE_ITEM_TASK_CODE">Task Code:</label>
<input type="text" id="LINE_ITEM_TASK_CODE" name="LINE_ITEM_TASK_CODE"><br>
<label for= "LINE_ITEM_EXPENSE_CODE">Expense Code:</label> For more information see <a href ="https://ledes.org/wp-content/uploads/2016/04/2013-LOC-Revised-UTBMS-Activity-Codes.pdf"> Activity Codes <a>
<input type="text" id="LINE_ITEM_EXPENSE_CODE" name="LINE_ITEM_EXPENSE_CODE"><br>
<label for= "LINE_ITEM_ACTIVITY_CODE">Activity Code:</label> For more information see <a href ="https://ledes.org/wp-content/uploads/2016/04/2013-LOC-Revised-UTBMS-Activity-Codes.pdf"> Expense Codes <a>
<input type="text" id="LINE_ITEM_ACTIVITY_CODE" name="LINE_ITEM_ACTIVITY_CODE"><br>
<! -- NEED A DEFAULT FOR THIS. -->
<label for= "EXP_FEE_INV_ADJ_TYPE">Expense/Fee/Inv/Adj: </label>
<input type="text" id="EXP_FEE_INV_ADJ_TYPE" name="EXP_FEE_INV_ADJ_TYPE"><br>
<label for= "LINE_ITEM_ADJUSTMENT_AMOUNT">Line Item Adjustment Amount:</label> 
<input type="number" id="LINE_ITEM_TASK_CODE" name="LINE_ITEM_TASK_CODE">This field is optional.<br>
<br>
<button onclick="Line_Item_Submit()">Submit Line Item</button><br>
<button onclick="Invoice_Submit()">Done</button>
 </form>
 </body>
 </html>

 <script>

function Set_Defaults {
const TODAY = new Date();
alert("I am at Set Defaults");
// These are all the fields in the hell-spawn format known as LEDES. 
document.getElementById("INVOICE_DATE").value = TODAY;
let INVOICE_DATE = document.getElementById ("INVOICE_DATE").value ;
let INVOICE_NUMBER = document.getElementById ("INVOICE_NUMBER").value ;
let CLIENT_ID =	document.getElementById ("CLIENT_ID").value ;
let LAW_FIRM_MATTER_ID = document.getElementById ("LAW_FIRM_MATTER_ID").value;
let INVOICE_TOTAL 	= document.getElementById ("INVOICE_TOTAL").value;
let BILLING_START_DATE 	= document.getElementById ("BILLING_START_DATE").value;
let BILLING_END_DATE 	= document.getElementById ("BILLING_END_DATE").value;
let INVOICE_DESCRIPTION 	= document.getElementById ("INVOICE_DESCRIPTION").value;
let LINE_ITEM_NUMBER 	= document.getElementById ("LINE_ITEM_NUMBER").value;
let EXP_FEE_INV_ADJ_TYPE = document.getElementById ("EXP_FEE_INV_ADJ_TYPE").value;
let LINE_ITEM_NUMBER_OF_UNITS 	= document.getElementById ("LINE_ITEM_NUMBER_OF_UNITS").value;
let LINE_ITEM_ADJUSTMENT_AMOUNT 	=document.getElementById ("LINE_ITEM_ADJUSTMENT_AMOUNT").value;
let LINE_ITEM_TOTAL 	= document.getElementById ("LINE_ITEM_TOTAL").value;
document.getElementById ("LINE_ITEM_DATE").value = BILLING_START_DATE;
let LINE_ITEM_DATE 	= document.getElementById ("LINE_ITEM_DATE").value;
let LINE_ITEM_TASK_CODE 	= document.getElementById ("LINE_ITEM_TASK_CODE").value;
let LINE_ITEM_EXPENSE_CODE 	= document.getElementById ("LINE_ITEM_EXPENSE_CODE").value;
let LINE_ITEM_ACTIVITY_CODE 	= document.getElementById ("LINE_ITEM_ACTIVITY_CODE").value;
let TIMEKEEPER_ID 	= document.getElementById ("LINE_ITEM_ACTIVITY_CODE").value;
let LINE_ITEM_DESCRIPTION 	= document.getElementById ("LINE_ITEM_DESCRIPTION").value;
let LAW_FIRM_ID 	= document.getElementById ("LAW_FIRM_ID").value;
let LINE_ITEM_UNIT_COST 	=document.getElementById ("LINE_ITEM_UNIT_COST").value;
let TIMEKEEPER_NAME 	= document.getElementById ("TIMEKEEPER_NAME").value;
let TIMEKEEPER_CLASSIFICATION 	= document.getElementById ("TIMEKEEPER_CLASSIFICATION").value;
let CLIENT_MATTER_ID 	= document.getElementById ("CLIENT_MATTER_ID").value;

let PRINT_LINE = "";
let FILE_CONTENTS = "";

let INVOICE_TOTAL = 0
}


function Update_Line_Item_Total()
{
    let LINE_ITEM_TOTAL = LINE_ITEM_NUMBER_OF_UNITS * LINE_ITEM_UNIT_COST;
    document.getElementById("LINE_ITEM_TOTAL").value = LINE_ITEM_TOTAL;
}

function Line_Item_Submit()
{
let DELIMITER = "|"
let FILE_DELIMITER = "[]" 

let LINE_ITEM_NUMBER 	= LINE_ITEM_NUMBER +1
let INVOICE_TOTAL = INVOICE_TOTAL + LINE_ITEM_TOTAL

// Now add a line to the file

let PRINT_LINE = concat (PRINT_LINE +
formatDateYYYYMMDD(INVOICE_DATE) +DELIMITER +
INVOICE_NUMBER + DELIMITER +
CLIENT_ID + DELIMITER +
LAW_FIRM_MATTER_ID + DELIMITER +
INVOICE_TOTAL + DELIMITER +
formatDateYYYYMMDD(BILLING_START_DATE) + DELIMITER +
formatDateYYYYMMDD(BILLING_END_DATE) + DELIMITER +
INVOICE_DESCRIPTION + DELIMITER +
LINE_ITEM_NUMBER + DELIMITER +
EXP/FEE/INV_ADJ_TYPE + DELIMITER +
LINE_ITEM_NUMBER_OF_UNITS + DELIMITER +
LINE_ITEM_ADJUSTMENT_AMOUNT + DELIMITER +
LINE_ITEM_TOTAL + DELIMITER +
formatDateYYYYMMDD(LINE_ITEM_DATE) + DELIMITER +
LINE_ITEM_TASK_CODE + DELIMITER +
LINE_ITEM_EXPENSE_CODE + DELIMITER +
LINE_ITEM_ACTIVITY_CODE + DELIMITER +
TIMEKEEPER_ID + DELIMITER +
LINE_ITEM_DESCRIPTION + DELIMITER +
LAW_FIRM_ID + DELIMITER +
LINE_ITEM_UNIT_COST + DELIMITER +
TIMEKEEPER_NAME + DELIMITER +
TIMEKEEPER_CLASSIFICATION + DELIMITER +
CLIENT_MATTER_ID + DELIMITER) 
alert(PRINT_LINE) // for debugging
FILE_CONTENTS = concat (FILE_CONTENTS + PRINT_LINE)
PRINT_LINE = ""
}

function checkitemdate (){
console.log(isDateBetween(date, BOM, EOM))
}

function getPreviousMonthDates(date) {
    const firstDayOfGivenMonth = new Date(INVOICE_DATE.getFullYear(), date.getMonth(), 1);
    const lastDayOfPreviousMonth = new Date(firstDayOfGivenMonth);
    lastDayOfPreviousMonth.setDate(lastDayOfPreviousMonth.getDate() - 1);
    let BILLING_END_DATE = lastDayOfPreviousMonth;
    document.getElementById("BILLING_END_DATE").value = BILLING_END_DATE;
    const firstDayOfPreviousMonth = new Date(lastDayOfPreviousMonth.getFullYear(), lastDayOfPreviousMonth.getMonth(), 1);
    let BILLING_START_DATE = firstDayOfPreviousMonth;
    document.getElementById("BILLING_START_DATE").value = BILLING_START_DATE
  }

function Date_Check {
    If (isDateBetween(LINE_ITEM_DATE, BILLING_START_DATE, BILLING_END_DATE))} return else {alert("The line item date is outside the billing date range for this invoice.")
}

//Convert dates to YYYYMMDD format 
function formatDateYYYYMMDD(date) {
    return date.toISOString().slice(0, 10).replace(/-/g, '')
  }

function isDateBetween(date, startDate, endDate) {
    return (date >= startDate && date <= endDate)
  }
function Invoice_Submit()
{
    // Create a download link and trigger the download
    // Thanks to Claude for this idea!
    const a = document.createElement('a');
    a.href = URL.createObjectURL(FILE_CONTENTS);
    a.download = 'ledes_98b_output.txt';
    a.style.display = 'none';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    alert("Your file has been saved to LEDES.txt. Thanks for using the Bananafoot LEDES conversion program. Now go and re-think your life choices.")
}
</script>


