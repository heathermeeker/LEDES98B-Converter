
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bananafoot LEDES Converter</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            padding-top: 20px;
            padding-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2 class="mb-4">Bananafoot LEDES Converter</h2>
        <h3 class="text-muted mb-4"><i>"Bananafoot: Making your law practice slightly less tedious"</i></h3>
        <p class="mb-4">This program allows you to enter information to create a LEDES 1998B billing file. LEDES is a standard format for legal invoicing. 
        For information on the hell-spawn that is the LEDES format see <a href="https://ledes.org/ledes-98b-format" target="_blank">LEDES Format</a>.  
        LEDES is a text, pipe-delimited format. It was designed by lawyers, which explains a lot. When you click "Done" the program will allow you to save your LEDES file. SORRY, BUT YOU NEED TO ENTER THE INVOICE TOTAL. THE RUNNING TOTAL HERE IS PROVIDED TO CHECK YOUR WORK ONLY.</p>

        <form id="ledesForm" class="mb-4">
            <div class="row mb-3">
               
                <div class="col-md-3">
                    <p><strong>Lines Total:</strong> <span id="LINE_ITEM_NUMBER" class="badge bg-secondary">0</span></p>
                </div>
              <div class="col-md-3">
                    <label for="INVOICE_TOTAL" class="form-label">Invoice Total (Input):</label>
                    <input type="text" class="form-control" id="INVOICE_TOTAL" name="INVOICE_TOTAL" required>
                </div>
                <div class="col-md-6">
                    <p><strong>Invoice Total (Running):</strong> <span id="INVOICE_TOTAL_CALC" class="badge bg-primary">0</span></p>
                </div>
                
               

            <h4 class="mb-3">Invoice Information</h4>
            <div class="row g-3">
                <div class="col-md-3">
                    <label for="INVOICE_NUMBER" class="form-label">Invoice Number:</label>
                    <input type="text" class="form-control" id="INVOICE_NUMBER" name="INVOICE_NUMBER" required>
                </div>
                <div class="col-md-3">
                    <label for="INVOICE_DATE" class="form-label">Invoice Date:</label>
                    <input type="date" class="form-control" id="INVOICE_DATE" name="INVOICE_DATE" required>
                </div>
                <div class="col-md-3">
                    <label for="CLIENT_ID" class="form-label">Client ID:</label>
                    <input type="text" class="form-control" id="CLIENT_ID" name="CLIENT_ID" required>
                </div>
                <div class="col-md-3">
                    <label for="CLIENT_MATTER_ID" class="form-label">Client Matter ID:</label>
                    <input type="text" class="form-control" id="CLIENT_MATTER_ID" name="CLIENT_MATTER_ID" required>
                </div>
                <div class="col-md-3">
                    <label for="LAW_FIRM_MATTER_ID" class="form-label">Law Firm Matter:</label>
                    <input type="text" class="form-control" id="LAW_FIRM_MATTER_ID" name="LAW_FIRM_MATTER_ID" required>
                </div>
                <div class="col-md-3">
                    <label for="LAW_FIRM_ID" class="form-label">Law Firm ID (EIN):</label>
                    <input type="text" class="form-control" id="LAW_FIRM_ID" name="LAW_FIRM_ID" required>
                </div>
                <div class="col-md-3">
                    <label for="BILLING_START_DATE" class="form-label">Billing Start Date:</label>
                    <input type="date" class="form-control" id="BILLING_START_DATE" name="BILLING_START_DATE" required>
                </div>
                <div class="col-md-3">
                    <label for="BILLING_END_DATE" class="form-label">Billing End Date:</label>
                    <input type="date" class="form-control" id="BILLING_END_DATE" name="BILLING_END_DATE" required>
                </div>
                <div class="col-12">
                    <label for="INVOICE_DESCRIPTION" class="form-label">Invoice Description:</label>
                    <input type="text" class="form-control" id="INVOICE_DESCRIPTION" name="INVOICE_DESCRIPTION" value="Legal Services">
                </div>
            </div>

            <h4 class="mt-4 mb-3">Line Item Fields</h4>
            <div class="row g-3">
                <div class="col-md-3">
                    <label for="LINE_ITEM_DATE" class="form-label">Line Item Date:</label>
                    <input type="date" class="form-control" id="LINE_ITEM_DATE" name="LINE_ITEM_DATE" required>
                </div>
                <div class="col-md-3">
                    <label for="TIMEKEEPER_NAME" class="form-label">Timekeeper Name:</label>
                    <input type="text" class="form-control" id="TIMEKEEPER_NAME" name="TIMEKEEPER_NAME" required>
                (Last, First)</div>
                <div class="col-md-3">
                    <label for="TIMEKEEPER_ID" class="form-label">Timekeeper ID:</label>
                    <input type="text" class="form-control" id="TIMEKEEPER_ID" name="TIMEKEEPER_ID" required>
                </div>
              
               
                <div class="col-md-3">
                    <label for="TIMEKEEPER_CLASSIFICATION" class="form-label">Timekeeper Class:</label>
                    <input type="text" class="form-control" id="TIMEKEEPER_CLASSIFICATION" name="TIMEKEEPER_CLASSIFICATION" value="PARTNR" required>
                    <small class="form-text text-muted">See <a href="https://ledes.org/loc-revised-timekeeper-classification-codes-august-2014" target="_blank">Classification Codes</a> (e.g. PARTNR, ASSOC)</small>
                </div>
                <div class="col-md-3">
                    <label for="LINE_ITEM_NUMBER_OF_UNITS" class="form-label">Line Item Units:</label>
                    <input type="number" class="form-control" id="LINE_ITEM_NUMBER_OF_UNITS" name="LINE_ITEM_NUMBER_OF_UNITS" required>
                </div>
                   <div class="col-9">
                    <label for="LINE_ITEM_DESCRIPTION" class="form-label">Description:</label>
                    <input type="text" class="form-control" id="LINE_ITEM_DESCRIPTION" name="LINE_ITEM_DESCRIPTION" required>
                </div>
               
                <div class="col-md-3">
                    <label for="LINE_ITEM_UNIT_COST" class="form-label">Line Item Unit Cost:</label>
                    <input type="number" class="form-control" id="LINE_ITEM_UNIT_COST" name="LINE_ITEM_UNIT_COST" required>
                </div>
                <div class="col-md-3">
                    <label for="LINE_ITEM_TASK_CODE" class="form-label">Task Code (UTBMS):</label>
                    <input type="text" class="form-control" id="LINE_ITEM_TASK_CODE" name="LINE_ITEM_TASK_CODE" required>
                </div>
                <div class="col-md-3">
                    <label for="LINE_ITEM_EXPENSE_CODE" class="form-label">Expense Code:</label>
                    <input type="text" class="form-control" id="LINE_ITEM_EXPENSE_CODE" name="LINE_ITEM_EXPENSE_CODE" required>
                    <small class="form-text text-muted">See <a href="https://ledes.org/wp-content/uploads/2015/07/2013-LOC-Revised-UTBMS-Expense-Codes.pdf" target="_blank">Expense Codes</a> (E112 = FedEx/UPS)</small>
                </div>
                <div class="col-md-3">
                    <label for="LINE_ITEM_ACTIVITY_CODE" class="form-label">Activity Code:</label>
                    <input type="text" class="form-control" id="LINE_ITEM_ACTIVITY_CODE" name="LINE_ITEM_ACTIVITY_CODE" required>
                    <small class="form-text text-muted">See <a href="https://ledes.org/wp-content/uploads/2016/04/2013-LOC-Revised-UTBMS-Activity-Codes.pdf" target="_blank">Activity Codes</a> (A104 = Review/Analyze)</small>
                </div>
                <div class="col-md-3">
                    <label for="EXP_FEE_INV_ADJ_TYPE" class="form-label">Expense(E)/Fee(F):</label>
                    <input type="text" class="form-control" id="EXP_FEE_INV_ADJ_TYPE" name="EXP_FEE_INV_ADJ_TYPE" value="F" required>
                </div>
                <div class="col-md-3">
                    <label for="LINE_ITEM_ADJUSTMENT_AMOUNT" class="form-label">Adjustment Amount:</label>
                    <input type="number" class="form-control" id="LINE_ITEM_ADJUSTMENT_AMOUNT" name="LINE_ITEM_ADJUSTMENT_AMOUNT" value="0">
                </div>
            </div>

            <div class="mt-4">
                <button type="button" class="btn btn-primary" onclick="lineItemSubmit()">Submit Line Item</button>
                <button type="button" class="btn btn-success" onclick="invoiceSubmit()">Done</button>
            </div>
        </form>
    </div>
    <script src="https://js.puter.com/v2/"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let fileContents = "LEDES1998B[]INVOICE_DATE|INVOICE_NUMBER|CLIENT_ID|LAW_FIRM_MATTER_ID|INVOICE_TOTAL|BILLING_START_DATE|BILLING_END_DATE|INVOICE_DESCRIPTION|LINE_ITEM_NUMBER|EXP/FEE/INV_ADJ_TYPE|LINE_ITEM_NUMBER_OF_UNITS|LINE_ITEM_ADJUSTMENT_AMOUNT|LINE_ITEM_TOTAL|LINE_ITEM_DATE|LINE_ITEM_TASK_CODE|LINE_ITEM_EXPENSE_CODE|LINE_ITEM_ACTIVITY_CODE|TIMEKEEPER_ID|LINE_ITEM_DESCRIPTION|LAW_FIRM_ID|LINE_ITEM_UNIT_COST|TIMEKEEPER_NAME|TIMEKEEPER_CLASSIFICATION|CLIENT_MATTER_ID[]";
        let lineItemNumber = 0;
        let invoiceTotal = 0;

        function setDefaults() {
            const today = new Date();
            document.getElementById("INVOICE_DATE").value = today.toISOString().split('T')[0];
            getPreviousMonthDates(today);
        }

        function updateLineItemTotal() {
            const units = parseFloat(document.getElementById("LINE_ITEM_NUMBER_OF_UNITS").value) || 0;
            const cost = parseFloat(document.getElementById("LINE_ITEM_UNIT_COST").value) || 0;
            const adjustmentAmount = parseFloat(document.getElementById("LINE_ITEM_ADJUSTMENT_AMOUNT").value) || 0;
            const total = (units * cost) + adjustmentAmount;
            return total.toFixed(2);
        }

        function lineItemSubmit() {
            const lineItemTotal = updateLineItemTotal();
            lineItemNumber++;
            invoiceTotal += parseFloat(lineItemTotal);

            const delimiter = "|";
            const file_delimiter = "[]";
            let printLine = [
                formatDateYYYYMMDD(document.getElementById("INVOICE_DATE").value),
                document.getElementById("INVOICE_NUMBER").value,
                document.getElementById("CLIENT_ID").value,
                document.getElementById("LAW_FIRM_MATTER_ID").value,
                document.getElementById("INVOICE_TOTAL").value,
                formatDateYYYYMMDD(document.getElementById("BILLING_START_DATE").value),
                formatDateYYYYMMDD(document.getElementById("BILLING_END_DATE").value),
                document.getElementById("INVOICE_DESCRIPTION").value,
                lineItemNumber,
                document.getElementById("EXP_FEE_INV_ADJ_TYPE").value,
                document.getElementById("LINE_ITEM_NUMBER_OF_UNITS").value,
                document.getElementById("LINE_ITEM_ADJUSTMENT_AMOUNT").value,
                lineItemTotal,
                formatDateYYYYMMDD(document.getElementById("LINE_ITEM_DATE").value),
                document.getElementById("LINE_ITEM_TASK_CODE").value,
                document.getElementById("LINE_ITEM_EXPENSE_CODE").value,
                document.getElementById("LINE_ITEM_ACTIVITY_CODE").value,
                document.getElementById("TIMEKEEPER_ID").value,
                document.getElementById("LINE_ITEM_DESCRIPTION").value,
                document.getElementById("LAW_FIRM_ID").value,
                document.getElementById("LINE_ITEM_UNIT_COST").value,
                document.getElementById("TIMEKEEPER_NAME").value,
                document.getElementById("TIMEKEEPER_CLASSIFICATION").value,
                document.getElementById("CLIENT_MATTER_ID").value
            ].join(delimiter);

            fileContents += printLine + file_delimiter + "\n";
            document.getElementById("INVOICE_TOTAL_CALC").textContent = invoiceTotal.toFixed(2);
            document.getElementById("LINE_ITEM_NUMBER").textContent = lineItemNumber;

            // Reset line item fields
            document.getElementById("LINE_ITEM_DATE").value = "";
            //These fields should persist for useability, for most users, -- uncomment if you don't prefer that
            //document.getElementById("TIMEKEEPER_ID").value = "";
            //document.getElementById("LINE_ITEM_DESCRIPTION").value = "";
            document.getElementById("LINE_ITEM_NUMBER_OF_UNITS").value = "";
            document.getElementById("LINE_ITEM_UNIT_COST").value = "";
            document.getElementById("LINE_ITEM_ADJUSTMENT_AMOUNT").value = "0";
        }

        function invoiceSubmit() {
            const blob = new Blob([fileContents], { type: 'text/plain' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'ledes_98b_output.txt';
            a.style.display = 'none';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            alert("Your file has been saved. Thanks for using the Bananafoot LEDES conversion program. Now go and re-think your life choices.");
        }

        function getPreviousMonthDates(date) {
            const firstDayOfGivenMonth = new Date(date.getFullYear(), date.getMonth(), 1);
            const lastDayOfPreviousMonth = new Date(firstDayOfGivenMonth);
            lastDayOfPreviousMonth.setDate(lastDayOfPreviousMonth.getDate() - 1);
            document.getElementById("BILLING_END_DATE").value = lastDayOfPreviousMonth.toISOString().split('T')[0];

            const firstDayOfPreviousMonth = new Date(lastDayOfPreviousMonth.getFullYear(), lastDayOfPreviousMonth.getMonth(), 1);
            document.getElementById("BILLING_START_DATE").value = firstDayOfPreviousMonth.toISOString().split('T')[0];
        }

        function formatDateYYYYMMDD(dateString) {
            return dateString.replace(/-/g, '');
        }

        window.onload = setDefaults;
    </script>
</body>
</html>
